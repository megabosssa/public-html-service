<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Debugger</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../assets/css/global.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .output-box {
            background-color: #ffffff;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            padding: 10px;
            min-height: 200px;
            white-space: pre-wrap;
            font-family: monospace;
            overflow-x: auto;
        }
        .signature-box {
            min-height: 50px;
            word-break: break-all;
        }
        .error-msg {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
<nav class="simple-nav">
 <a href="../../index.html">Home</a> | <a href="javascript:history.back()">Back</a>
</nav>

<div class="container">
    <div class="mb-4">
        <h1>JWT Debugger</h1>
        <p class="text-muted">Decode and inspect JSON Web Tokens (JWTs) without sending them to a server.</p>
    </div>

    <div class="row">
        <div class="col-lg-5 mb-4">
            <label for="jwtInput" class="form-label fw-bold">Encoded Token</label>
            <textarea id="jwtInput" class="form-control font-monospace" rows="15" placeholder="Paste your JWT here..."></textarea>
            <div id="errorMsg" class="error-msg mt-2"></div>
        </div>

        <div class="col-lg-7">
            <div class="mb-3">
                <label class="form-label fw-bold text-primary">Header</label>
                <div id="headerOutput" class="output-box"></div>
            </div>
            <div class="mb-3">
                <label class="form-label fw-bold text-success">Payload</label>
                <div id="payloadOutput" class="output-box"></div>
            </div>
             <div class="mb-3">
                <label class="form-label fw-bold text-info">Signature (Base64)</label>
                <div id="signatureOutput" class="output-box signature-box text-muted"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const jwtInput = document.getElementById('jwtInput');
    const headerOutput = document.getElementById('headerOutput');
    const payloadOutput = document.getElementById('payloadOutput');
    const signatureOutput = document.getElementById('signatureOutput');
    const errorMsg = document.getElementById('errorMsg');

    function base64UrlDecode(str) {
        // Add padding if needed
        str = str.replace(/-/g, '+').replace(/_/g, '/');
        while (str.length % 4) {
            str += '=';
        }

        try {
            // Decode base64 and handle UTF-8 characters correctly
            return decodeURIComponent(atob(str).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
        } catch (e) {
            throw new Error("Invalid Base64 string");
        }
    }

    function decodeJWT() {
        const token = jwtInput.value.trim();
        errorMsg.textContent = '';
        headerOutput.textContent = '';
        payloadOutput.textContent = '';
        signatureOutput.textContent = '';

        if (!token) return;

        const parts = token.split('.');
        if (parts.length !== 3) {
            // It might be a JWE (5 parts) or just invalid
            if (parts.length === 5) {
                errorMsg.textContent = 'This looks like a JWE (Encrypted JWT). This debugger currently supports signed JWTs (3 parts).';
            } else {
                errorMsg.textContent = `Invalid JWT format. Expected 3 parts separated by dots, found ${parts.length}.`;
            }
            return;
        }

        try {
            const header = JSON.parse(base64UrlDecode(parts[0]));
            headerOutput.textContent = JSON.stringify(header, null, 2);
        } catch (e) {
            headerOutput.textContent = 'Error decoding header: ' + e.message;
        }

        try {
            const payload = JSON.parse(base64UrlDecode(parts[1]));
            payloadOutput.textContent = JSON.stringify(payload, null, 2);
        } catch (e) {
            payloadOutput.textContent = 'Error decoding payload: ' + e.message;
        }

        signatureOutput.textContent = parts[2];
    }

    jwtInput.addEventListener('input', decodeJWT);
</script>

</body>
</html>
