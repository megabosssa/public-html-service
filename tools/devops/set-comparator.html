<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Comparison Tool</title>
    <link rel="icon" type="image/svg+xml" href="../../assets/images/favicon.svg">
    <!-- We'll use Tailwind CSS for easy and clean styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/venn.js@0.2.20/build/venn.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        /* Custom style for a consistent textarea height */
        textarea {
            min-height: 350px;
        }

        /* Venn diagram styles */
        #venn-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Inter', sans-serif;
        }

        .venntooltip {
            position: absolute;
            text-align: center;
            width: 128px;
            height: 16px;
            background: #333;
            color: #ddd;
            padding: 2px;
            border: 0px;
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>

<body
    class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans p-4 md:p-8 transition-colors duration-200">

    <div class="max-w-7xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div class="text-center md:text-left">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-white">Set Comparison Tool</h1>
                <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">
                    Paste your lists below. The tool will find differences regardless of order or duplicates.
                </p>
            </div>
            <button id="themeToggle"
                class="mt-4 md:mt-0 p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
                aria-label="Toggle Dark Mode">
                <!-- Sun Icon -->
                <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-500 hidden" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <!-- Moon Icon -->
                <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
        </header>

        <!-- Input Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-colors duration-200">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-2xl font-semibold text-blue-700 dark:text-blue-400">Set 1</h2>
                    <button id="clearSet1"
                        class="text-xs bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-semibold py-1 px-3 rounded transition-colors duration-200">
                        Clear
                    </button>
                </div>
                <textarea id="set1"
                    class="w-full h-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"
                    placeholder="Paste Set 1 here (one item per line)..."></textarea>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-colors duration-200">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-2xl font-semibold text-indigo-700 dark:text-indigo-400">Set 2</h2>
                    <button id="clearSet2"
                        class="text-xs bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-semibold py-1 px-3 rounded transition-colors duration-200">
                        Clear
                    </button>
                </div>
                <textarea id="set2"
                    class="w-full h-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"
                    placeholder="Paste Set 2 here (one item per line)..."></textarea>
            </div>
        </div>

        <!-- Options Section -->
        <div
            class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md mb-6 flex flex-wrap gap-4 items-center justify-center transition-colors duration-200">
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" id="caseSensitive"
                    class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700"
                    checked>
                <span class="ml-2 text-gray-700 dark:text-gray-300">Case Sensitive</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" id="ignoreWhitespace"
                    class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700"
                    checked>
                <span class="ml-2 text-gray-700 dark:text-gray-300">Ignore Whitespace</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" id="sortResults"
                    class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700"
                    checked>
                <span class="ml-2 text-gray-700 dark:text-gray-300">Sort Results</span>
            </label>
        </div>

        <!-- Control Button -->
        <button id="compareButton"
            class="w-full bg-blue-600 dark:bg-blue-700 text-white font-bold text-lg py-4 px-6 rounded-xl shadow-md hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800 transition-all duration-200 ease-in-out transform hover:-translate-y-0.5 mb-8">
            Compare Sets
        </button>

        <!-- Venn Diagram Section -->
        <div id="venn-container"
            class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8 hidden transition-colors duration-200">
            <h2 class="text-2xl font-semibold mb-3 text-center text-gray-700 dark:text-gray-200">Venn Diagram Result
            </h2>
            <div id="venn-diagram" class="w-full h-[400px]"></div>
        </div>

        <!-- Output Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Column 1: Only in Set 1 -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 transition-colors duration-200">
                <div
                    class="bg-red-50 dark:bg-red-900/30 p-4 border-b border-red-100 dark:border-red-900/50 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-red-800 dark:text-red-200">Only in Set 1</h3>
                    <div class="flex items-center gap-2">
                        <button id="copyOnly1"
                            class="text-xs bg-red-100 dark:bg-red-900/50 hover:bg-red-200 dark:hover:bg-red-800/50 text-red-800 dark:text-red-200 font-semibold py-1 px-3 rounded transition-colors duration-200">
                            Copy
                        </button>
                        <span id="countOnly1"
                            class="bg-red-200 dark:bg-red-800/50 text-red-800 dark:text-red-200 text-xs font-bold px-2.5 py-0.5 rounded-full">0</span>
                    </div>
                </div>
                <div class="p-4 h-full relative group">
                    <textarea id="onlyIn1" readonly
                        class="w-full h-64 p-3 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900/50 text-gray-700 dark:text-gray-200 font-mono text-sm shadow-inner focus:outline-none focus:ring-2 focus:ring-red-200 dark:focus:ring-red-900"
                        placeholder="Items unique to Set 1..."></textarea>
                </div>
            </div>

            <!-- Column 2: Only in Set 2 -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 transition-colors duration-200">
                <div
                    class="bg-amber-50 dark:bg-amber-900/30 p-4 border-b border-amber-100 dark:border-amber-900/50 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-amber-800 dark:text-amber-200">Only in Set 2</h3>
                    <div class="flex items-center gap-2">
                        <button id="copyOnly2"
                            class="text-xs bg-amber-100 dark:bg-amber-900/50 hover:bg-amber-200 dark:hover:bg-amber-800/50 text-amber-800 dark:text-amber-200 font-semibold py-1 px-3 rounded transition-colors duration-200">
                            Copy
                        </button>
                        <span id="countOnly2"
                            class="bg-amber-200 dark:bg-amber-800/50 text-amber-800 dark:text-amber-200 text-xs font-bold px-2.5 py-0.5 rounded-full">0</span>
                    </div>
                </div>
                <div class="p-4 h-full relative group">
                    <textarea id="onlyIn2" readonly
                        class="w-full h-64 p-3 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900/50 text-gray-700 dark:text-gray-200 font-mono text-sm shadow-inner focus:outline-none focus:ring-2 focus:ring-amber-200 dark:focus:ring-amber-900"
                        placeholder="Items unique to Set 2..."></textarea>
                </div>
            </div>

            <!-- Column 3: Common to Both -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 transition-colors duration-200">
                <div
                    class="bg-green-50 dark:bg-green-900/30 p-4 border-b border-green-100 dark:border-green-900/50 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-green-800 dark:text-green-200">Common to Both</h3>
                    <div class="flex items-center gap-2">
                        <button id="copyCommon"
                            class="text-xs bg-green-100 dark:bg-green-900/50 hover:bg-green-200 dark:hover:bg-green-800/50 text-green-800 dark:text-green-200 font-semibold py-1 px-3 rounded transition-colors duration-200">
                            Copy
                        </button>
                        <span id="countCommon"
                            class="bg-green-200 dark:bg-green-800/50 text-green-800 dark:text-green-200 text-xs font-bold px-2.5 py-0.5 rounded-full">0</span>
                    </div>
                </div>
                <div class="p-4 h-full relative group">
                    <textarea id="common" readonly
                        class="w-full h-64 p-3 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900/50 text-gray-700 dark:text-gray-200 font-mono text-sm shadow-inner focus:outline-none focus:ring-2 focus:ring-green-200 dark:focus:ring-green-900"
                        placeholder="Items found in both sets..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle Logic
        const themeToggleBtn = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        const html = document.documentElement;

        // Check for saved user preference, if any, on load
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
        } else {
            html.classList.remove('dark');
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
        }

        themeToggleBtn.addEventListener('click', function () {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('color-theme', 'light');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                html.classList.add('dark');
                localStorage.setItem('color-theme', 'dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }

            // Redraw Venn diagram if it's visible and we have data
            if (!document.getElementById('venn-container').classList.contains('hidden')) {
                // We need to re-run compare to redraw, but we can't easily access the sizes without re-processing
                // So we'll just trigger the compare function again
                compareSets();
            }
        });

        // Attach event listener to the button
        document.getElementById('compareButton').addEventListener('click', compareSets);

        // Clear Buttons
        document.getElementById('clearSet1').addEventListener('click', () => {
            document.getElementById('set1').value = '';
            document.getElementById('set1').focus();
        });
        document.getElementById('clearSet2').addEventListener('click', () => {
            document.getElementById('set2').value = '';
            document.getElementById('set2').focus();
        });

        // Copy Buttons Helper
        function attachCopyListener(btnId, targetId) {
            const btn = document.getElementById(btnId);
            btn.addEventListener('click', () => {
                const text = document.getElementById(targetId).value;
                if (!text) return;

                navigator.clipboard.writeText(text).then(() => {
                    const originalText = btn.textContent;
                    const originalClasses = btn.className;

                    btn.textContent = 'Copied!';
                    // Keep layout classes but change colors
                    btn.className = btn.className.replace(/bg-\w+-100/, 'bg-green-100').replace(/text-\w+-800/, 'text-green-800').replace(/hover:bg-\w+-200/, '');

                    setTimeout(() => {
                        btn.textContent = originalText.trim();
                        btn.className = originalClasses;
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            });
        }

        attachCopyListener('copyOnly1', 'onlyIn1');
        attachCopyListener('copyOnly2', 'onlyIn2');
        attachCopyListener('copyCommon', 'common');

        /**
         * Takes text from a textarea, splits it by newline,
         * trims whitespace, and filters out empty lines.
         * Returns a Set of unique items.
         */
        function processInput(text, caseSensitive, ignoreWhitespace) {
            // Split by newline
            let items = text.split('\n');

            if (ignoreWhitespace) {
                items = items.map(item => item.trim());
            }

            if (!caseSensitive) {
                items = items.map(item => item.toLowerCase());
            }

            // Filter out empty lines
            items = items.filter(item => item.length > 0);

            return new Set(items);
        }

        /**
         * Main function to run the comparison
         */
        function compareSets() {
            // 1. Get options
            const isCaseSensitive = document.getElementById('caseSensitive').checked;
            const isIgnoreWhitespace = document.getElementById('ignoreWhitespace').checked;
            const isSort = document.getElementById('sortResults').checked;

            // 2. Get text from both textareas
            const text1 = document.getElementById('set1').value;
            const text2 = document.getElementById('set2').value;

            // 3. Process text into Sets for efficient comparison
            const s1 = processInput(text1, isCaseSensitive, isIgnoreWhitespace);
            const s2 = processInput(text2, isCaseSensitive, isIgnoreWhitespace);

            // 4. Calculate differences using Set logic
            // Use spread operator [...] to convert Set back to Array for filtering
            const onlyIn1 = [...s1].filter(item => !s2.has(item));
            const onlyIn2 = [...s2].filter(item => !s1.has(item));
            const common = [...s1].filter(item => s2.has(item));

            // 5. Sort results if requested
            if (isSort) {
                const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: 'base' });
                onlyIn1.sort(collator.compare);
                onlyIn2.sort(collator.compare);
                common.sort(collator.compare);
            }

            // 6. Display results in the output textareas
            // Use join('\n') to put one item per line
            document.getElementById('onlyIn1').value = onlyIn1.join('\n');
            document.getElementById('onlyIn2').value = onlyIn2.join('\n');
            document.getElementById('common').value = common.join('\n');

            // 7. Update counts in the headers
            document.getElementById('countOnly1').textContent = onlyIn1.length;
            document.getElementById('countOnly2').textContent = onlyIn2.length;
            document.getElementById('countCommon').textContent = common.length;

            // 8. Draw Venn Diagram
            drawVennDiagram(s1.size, s2.size, common.length);
        }

        function drawVennDiagram(size1, size2, commonSize) {
            const container = document.getElementById('venn-container');
            container.classList.remove('hidden');

            const chartDiv = document.getElementById('venn-diagram');
            chartDiv.innerHTML = ''; // Clear previous diagram

            const sets = [
                { sets: ['Set 1'], size: size1 },
                { sets: ['Set 2'], size: size2 },
                { sets: ['Set 1', 'Set 2'], size: commonSize }
            ];

            const chart = venn.VennDiagram()
                .width(chartDiv.clientWidth)
                .height(400);

            const div = d3.select("#venn-diagram");
            div.datum(sets).call(chart);

            // Determine colors based on dark mode
            const isDark = document.documentElement.classList.contains('dark');

            // Set 1 Colors
            const fill1 = isDark ? "#3B82F6" : "#BFDBFE"; // Blue
            const stroke1 = isDark ? "#60A5FA" : "#3B82F6";

            // Set 2 Colors
            const fill2 = isDark ? "#6366F1" : "#C7D2FE"; // Indigo
            const stroke2 = isDark ? "#818CF8" : "#6366F1";

            // Text Color
            const textColor = isDark ? "#E5E7EB" : "#374151";

            div.selectAll("g[data-venn-sets='Set 1'] path")
                .style("fill", fill1)
                .style("fill-opacity", 0.6)
                .style("stroke", stroke1)
                .style("stroke-width", 1);

            div.selectAll("g[data-venn-sets='Set 2'] path")
                .style("fill", fill2)
                .style("fill-opacity", 0.6)
                .style("stroke", stroke2)
                .style("stroke-width", 1);

            // Intersection styling (often handled automatically by transparency, but can enforce)
            div.selectAll("g[data-venn-sets='Set 1_Set 2'] path")
                .style("fill-opacity", 0.1) // Let the blend show
                .style("stroke-width", 0);

            // Text styling
            div.selectAll("text")
                .style("font-family", "Inter, sans-serif")
                .style("fill", textColor)
                .style("font-size", "16px");

            // Add tooltips
            const tooltip = d3.select("body").append("div")
                .attr("class", "venntooltip");

            div.selectAll("g")
                .on("mouseover", function (event, d) {
                    // sort all the areas relative to the current item
                    venn.sortAreas(div, d);

                    // Display a tooltip with the current size
                    tooltip.transition().duration(400).style("opacity", .9);
                    tooltip.text(d.size + " items");

                    // highlight the current path
                    const selection = d3.select(this).transition("tooltip").duration(400);
                    selection.select("path")
                        .style("fill-opacity", d.sets.length == 1 ? .8 : .4)
                        .style("stroke-opacity", 1);
                })
                .on("mousemove", function (event) {
                    tooltip.style("left", (event.pageX) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function (event, d) {
                    tooltip.transition().duration(400).style("opacity", 0);
                    const selection = d3.select(this).transition("tooltip").duration(400);
                    selection.select("path")
                        .style("fill-opacity", d.sets.length == 1 ? .6 : .1)
                        .style("stroke-opacity", d.sets.length == 1 ? 1 : 0);
                });
        }
    </script>

</body>

</html>