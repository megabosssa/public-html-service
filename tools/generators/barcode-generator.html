<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Generate Code128, EAN-13, UPC-A, and Code39 barcodes with customization options">
    <title>Barcode Generator | Dev Tools</title>
    <link rel="icon" type="image/svg+xml" href="../../assets/images/favicon.svg">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../assets/css/shared-styles.css">
    <style>
        .barcode-preview {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: white;
            border-radius: var(--radius-lg);
            min-height: 200px;
            overflow-x: auto;
        }

        .barcode-preview svg {
            max-width: 100%;
            height: auto;
        }

        .barcode-placeholder {
            color: #999;
            text-align: center;
        }

        .barcode-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .format-info {
            background: var(--color-bg-tertiary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            margin-bottom: 1rem;
        }

        .format-info strong {
            color: var(--color-accent);
        }
    </style>
</head>

<body>
    <div class="tool-container">
        <a href="../../index.html" class="nav-back"><i class="bi bi-arrow-left"></i> Back to Tools</a>

        <header class="tool-header">
            <h1><i class="bi bi-upc-scan"></i> Barcode Generator</h1>
            <div class="tool-actions"></div>
        </header>

        <div class="split-container">
            <!-- Input Panel -->
            <div class="panel">
                <h2 class="panel-title" style="margin-bottom: 1rem;">
                    <i class="bi bi-gear"></i> Configuration
                </h2>

                <div class="form-group">
                    <label class="form-label">Barcode Format</label>
                    <select id="barcodeFormat" class="form-select">
                        <option value="CODE128">Code 128 (Alphanumeric)</option>
                        <option value="CODE39">Code 39 (Alphanumeric)</option>
                        <option value="EAN13">EAN-13 (13 digits)</option>
                        <option value="EAN8">EAN-8 (8 digits)</option>
                        <option value="UPC">UPC-A (12 digits)</option>
                        <option value="ITF14">ITF-14 (14 digits)</option>
                        <option value="pharmacode">Pharmacode (Numbers)</option>
                    </select>
                </div>

                <div id="formatInfo" class="format-info">
                    <strong>Code 128:</strong> Supports all ASCII characters. Best for general-purpose use.
                </div>

                <div class="form-group">
                    <label class="form-label">Data / Value</label>
                    <input type="text" id="barcodeValue" class="form-input" placeholder="Enter barcode value...">
                </div>

                <h3 style="font-size: var(--font-size-md); margin: 1.5rem 0 1rem;">Display Options</h3>

                <div class="options-grid">
                    <div class="form-group">
                        <label class="form-label">Width (bars)</label>
                        <select id="barcodeWidth" class="form-select">
                            <option value="1">1 (Thin)</option>
                            <option value="2" selected>2 (Normal)</option>
                            <option value="3">3 (Wide)</option>
                            <option value="4">4 (Extra Wide)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Height (px)</label>
                        <select id="barcodeHeight" class="form-select">
                            <option value="50">50</option>
                            <option value="75">75</option>
                            <option value="100" selected>100</option>
                            <option value="150">150</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Show Text</label>
                        <select id="barcodeDisplayValue" class="form-select">
                            <option value="true" selected>Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Font Size</label>
                        <select id="barcodeFontSize" class="form-select">
                            <option value="12">12px</option>
                            <option value="16">16px</option>
                            <option value="20" selected>20px</option>
                            <option value="24">24px</option>
                        </select>
                    </div>
                </div>

                <button type="button" class="btn btn-primary btn-lg" id="generateBtn"
                    style="width: 100%; margin-top: 1rem;">
                    <i class="bi bi-upc-scan"></i> Generate Barcode
                </button>

                <div style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-top: 0.5rem;">
                    <kbd>Ctrl</kbd> + <kbd>Enter</kbd> to generate
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Preview</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button type="button" class="btn btn-secondary" id="downloadPngBtn" disabled>
                            <i class="bi bi-download"></i> PNG
                        </button>
                        <button type="button" class="btn btn-secondary" id="downloadSvgBtn" disabled>
                            <i class="bi bi-download"></i> SVG
                        </button>
                    </div>
                </div>

                <div id="barcodePreview" class="barcode-preview">
                    <div class="barcode-placeholder">
                        <i class="bi bi-upc-scan"></i>
                        <div>Enter a value and click Generate</div>
                    </div>
                </div>

                <div id="errorMessage" class="status-message status-error" style="display: none; margin-top: 1rem;">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <script src="../../assets/js/shared-utils.js"></script>
    <script>
        // DOM Elements
        const barcodeFormat = document.getElementById('barcodeFormat');
        const barcodeValue = document.getElementById('barcodeValue');
        const barcodeWidth = document.getElementById('barcodeWidth');
        const barcodeHeight = document.getElementById('barcodeHeight');
        const barcodeDisplayValue = document.getElementById('barcodeDisplayValue');
        const barcodeFontSize = document.getElementById('barcodeFontSize');
        const generateBtn = document.getElementById('generateBtn');
        const barcodePreview = document.getElementById('barcodePreview');
        const downloadPngBtn = document.getElementById('downloadPngBtn');
        const downloadSvgBtn = document.getElementById('downloadSvgBtn');
        const formatInfo = document.getElementById('formatInfo');
        const errorMessage = document.getElementById('errorMessage');

        const formatInfoTexts = {
            CODE128: '<strong>Code 128:</strong> Supports all ASCII characters. Best for general-purpose use.',
            CODE39: '<strong>Code 39:</strong> Supports A-Z, 0-9, and some special chars. Common in logistics.',
            EAN13: '<strong>EAN-13:</strong> 13-digit numeric code used in retail worldwide.',
            EAN8: '<strong>EAN-8:</strong> 8-digit compact version of EAN-13 for small products.',
            UPC: '<strong>UPC-A:</strong> 12-digit code standard in North America retail.',
            ITF14: '<strong>ITF-14:</strong> 14-digit code for shipping cartons and pallets.',
            pharmacode: '<strong>Pharmacode:</strong> Numeric code (3-131070) used in pharmaceutical industry.'
        };

        // Initialize tool
        initTool({
            toolName: 'barcode',
            onExecute: generateBarcode,
            onHistorySelect: (value) => {
                barcodeValue.value = value;
                generateBarcode();
            },
            getShareData: () => ({
                format: barcodeFormat.value,
                value: barcodeValue.value
            })
        });

        // Event listeners
        barcodeFormat.addEventListener('change', () => {
            formatInfo.innerHTML = formatInfoTexts[barcodeFormat.value] || '';

            // Set example values
            const examples = {
                CODE128: 'ABC-12345',
                CODE39: 'HELLO123',
                EAN13: '5901234123457',
                EAN8: '12345670',
                UPC: '123456789012',
                ITF14: '12345678901231',
                pharmacode: '1234'
            };

            if (!barcodeValue.value) {
                barcodeValue.placeholder = `e.g., ${examples[barcodeFormat.value] || ''}`;
            }
        });

        generateBtn.addEventListener('click', generateBarcode);
        downloadPngBtn.addEventListener('click', downloadPNG);
        downloadSvgBtn.addEventListener('click', downloadSVG);

        function generateBarcode() {
            const value = barcodeValue.value.trim();
            if (!value) {
                barcodePreview.innerHTML = `
                    <div class="barcode-placeholder">
                        <i class="bi bi-exclamation-circle"></i>
                        <div>Please enter a value</div>
                    </div>
                `;
                errorMessage.style.display = 'none';
                return;
            }

            try {
                // Create SVG element
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.id = 'barcodeSvg';

                JsBarcode(svg, value, {
                    format: barcodeFormat.value,
                    width: parseInt(barcodeWidth.value),
                    height: parseInt(barcodeHeight.value),
                    displayValue: barcodeDisplayValue.value === 'true',
                    fontSize: parseInt(barcodeFontSize.value),
                    margin: 10,
                    background: '#ffffff',
                    lineColor: '#000000'
                });

                barcodePreview.innerHTML = '';
                barcodePreview.appendChild(svg);

                downloadPngBtn.disabled = false;
                downloadSvgBtn.disabled = false;
                errorMessage.style.display = 'none';

                HistoryManager.addToHistory('barcode', value);
            } catch (err) {
                barcodePreview.innerHTML = `
                    <div class="barcode-placeholder" style="color: var(--color-danger);">
                        <i class="bi bi-x-circle"></i>
                        <div>Invalid barcode value</div>
                    </div>
                `;
                errorMessage.textContent = err.message;
                errorMessage.style.display = 'block';
                downloadPngBtn.disabled = true;
                downloadSvgBtn.disabled = true;
            }
        }

        function downloadPNG() {
            const svg = document.getElementById('barcodeSvg');
            if (!svg) return;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const data = new XMLSerializer().serializeToString(svg);
            const img = new Image();

            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);

                const link = document.createElement('a');
                link.download = `barcode-${barcodeValue.value}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            };

            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(data)));
        }

        function downloadSVG() {
            const svg = document.getElementById('barcodeSvg');
            if (!svg) return;

            const data = new XMLSerializer().serializeToString(svg);
            const blob = new Blob([data], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.download = `barcode-${barcodeValue.value}.svg`;
            link.href = url;
            link.click();

            URL.revokeObjectURL(url);
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>

</html>